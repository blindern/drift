- hosts: coreos
  become: yes
  gather_facts: no
  roles:
    - role: coreos-python
      tags: coreos-python

- hosts: coreos
  become: yes
  roles:
    # (Not using dyndns for now, keeping records in Domeneshop
    # manually updated.)
    # - role: dyndns
    #   tags: dyndns
    - role: git-crypt
      tags: git-crypt
    - role: zerotier
      tags: zerotier
    - role: docker-network
      tags: docker-network
    - role: coreos-etcd
      tags: coreos-etcd
    - role: coreos-docker
      tags: coreos-docker

# Services running on coreos-1.
- hosts: coreos-1
  become: yes
  vars:
    # TODO: Find out how we will automate updating this.
    smaabruket_availability_api_image: blindern/smaabruket-availability-api:20191226-1719-776
    smaabruket_availability_api_ipv4_address: "172.25.16.7"
    # TODO: Find out how we will automate updating this.
    users_api_image: blindern/users-api:20191228-0129-241
    users_api_ipv4_address: "172.25.16.2"
    okoreports_backend_image: cybernetisk/okoreports-backend
    okoreports_backend_ipv4_address: "172.25.16.5"
    okoreports_frontend_image: cybernetisk/okoreports-frontend
    okoreports_frontend_ipv4_address: "172.25.16.6"
    slack_invite_automation_image: blindern/slack-invite-automation:20191228-0708
    slack_invite_automation_ipv4_address: "172.25.16.9"

  roles:
    - role: service-users-api
      tags: service-users-api
    - role: service-smaabruket-availability-api
      tags: service-smaabruket-availability-api
    - role: service-okoreports
      tags: service-okoreports
    - role: service-slack-invite-automation
      tags: service-slack-invite-automation

# Services running on coreos-2.
- hosts: coreos-2
  become: yes
  vars:
    phpmyadmin_image: phpmyadmin/phpmyadmin:5
    phpmyadmin_ipv4_address: "172.25.16.12"
  roles:
    # - role: service-web-1
    #   tags: service-web-1
    # - role: service-intern
    #   tags: service-intern
    # - role: service-dugnaden
    #   tags: service-dugnaden
    # - role: service-phpldapadmin
    #   tags: service-phpldapadmin
    - role: service-phpmyadmin
      tags: service-phpmyadmin
    # - role: service-simplesamlphp
    #   tags: service-simplesamlphp

# Services running on coreos-3.
- hosts: coreos-3
  become: yes
  vars:
    confluence_image: blindern/confluence:20191228-1213
    confluence_ipv4_address: "172.25.16.8"
    mysql_1_image: mysql:8
    mysql_1_ipv4_address: "172.25.16.40"
    mysql_2_image: mysql:5.6
    mysql_2_ipv4_address: "172.25.16.43"
  roles:
    - role: service-confluence
      tags: service-confluence
    - role: service-mysql-1
      tags: service-mysql-1
    - role: service-mysql-2
      tags: service-mysql-2
    # - role: service-mongodb-1
    #   tags: service-mongodb-1

# Services running on coreos-4.
- hosts: coreos-4
  become: yes
  roles: []
    # - role: service-ldap-master
    #   tags: service-ldap-master
    # - role: service-postgresql-1
    #   tags: service-postgresql-1
